(()=>{"use strict";var e=function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-35/cards/".concat(e),{method:"DELETE",headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},t=document.querySelector("#card-template").content;function n(e,n,o,r,a,c){var u=t.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image");i.src=e.link,i.alt=e.name,u.querySelector(".card__title").textContent=e.name;var s=u.querySelector(".card__delete-button");e.owner._id!==a&&s.remove(),s.addEventListener("click",(function(){n(s,c,e._id)}));var p=u.querySelector(".card__like-button"),l=u.querySelector(".card__like-counter");return l.textContent=e.likes.length,p.addEventListener("click",(function(t){o(t,e._id,l)})),i.addEventListener("click",(function(){r(e)})),u}function o(e,t,n){var o=e.closest(".places__item");t(n).then((function(){o.remove()}))}function r(e,t,n){e.target.classList.toggle("card__like-button_is-active"),e.target.classList.contains("card__like-button_is-active")?function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-35/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(e){n.textContent=e.likes.length})):function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-35/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(e){n.textContent=e.likes.length}))}var a=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("form__input-error_active"),n.textContent=""},c=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("form__submit_inactive")):(t.disabled=!0,t.classList.add("form__submit_inactive"))};function u(e){if(27===e.keyCode){var t=document.querySelector(".popup_is-opened");t&&s(t)}}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function s(e){var t=e.querySelector(".popup__form");t&&t.querySelectorAll(".popup__input").forEach((function(e){a(t,e)})),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function p(e){e.target===e.currentTarget&&s(e.currentTarget)}function l(e){var t=e.currentTarget.querySelector(".popup__close");e.target===t&&s(e.currentTarget)}var d=document.querySelector(".places__list"),f=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),v=document.querySelector(".profile__edit-button"),y=document.querySelectorAll(".popup"),h=document.querySelector(".profile__add-button"),S=document.querySelector('form[name="edit-profile"]'),q=document.querySelector(".popup__input_type_name"),k=document.querySelector(".popup__input_type_description"),b=document.querySelector('form[name="new-place"]'),g=document.querySelector(".popup__input_type_card-name"),C=document.querySelector(".popup__input_type_url"),E=m.querySelector(".popup__image"),L=m.querySelector(".popup__caption"),j=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),T=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_avatar"),P=document.querySelector('form[name="avatar"]'),A=document.querySelector(".popup__input_type_avatar-url"),z=null;function D(e){E.src=e.link,E.alt=e.name,L.textContent=e.name,i(m)}v.addEventListener("click",(function(){q.value=j.textContent,k.value=x.textContent,i(f)})),h.addEventListener("click",(function(){i(_)})),T.addEventListener("click",(function(){i(w)})),y.forEach((function(e){e.addEventListener("click",p)})),y.forEach((function(e){e.addEventListener("keydown",u)})),y.forEach((function(e){e.addEventListener("click",l)})),S.addEventListener("submit",(function(e){e.preventDefault();var t,n,o,r,a=e.target.querySelector(".popup__button");a.disabled=!0,a.textContent="Сохранение...",(t={name:q.value,about:k.value},n=t.name,o=t.about,r=t.avatar,fetch("https://nomoreparties.co/v1/wff-cohort-35/users/me",{method:"PATCH",headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d","Content-Type":"application/json"},body:JSON.stringify({name:n,about:o,avatar:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){j.textContent=e.name,x.textContent=e.about,s(f)})).finally((function(){a.disabled=!1,a.textContent="Сохранить"}))})),b.addEventListener("submit",(function(t){t.preventDefault();var a=t.target.querySelector(".popup__button");a.disabled=!0,a.textContent="Сохранение...";var c,u,i,p=C.value;(c={name:g.value,link:p},u=c.name,i=c.link,fetch("https://nomoreparties.co/v1/wff-cohort-35/cards",{method:"POST",headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d","Content-Type":"application/json"},body:JSON.stringify({name:u,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){var a=n(t,o,r,D,z,e);d.prepend(a),b.reset(),s(_)})).finally((function(){a.disabled=!1,a.textContent="Сохранить"}))})),P.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(".popup__button");n.disabled=!0,n.textContent="Сохранение...",(t={avatar:A.value},fetch("https://nomoreparties.co/v1/wff-cohort-35/users/me/avatar",{method:"PATCH",headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d","Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url('".concat(e.avatar,"')"),console.log(e.avatar),s(w),P.reset()})).finally((function(){n.disabled=!1,n.textContent="Сохранить"}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");c(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.classList.contains("popup__input_text")&&(!/^[\t-\r \x2DA-Za-z\xA0\u0401\u0410-\u044F\u0451\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+$/.test(t.value)&&t.value?t.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity("")),t.validity.valid?a(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("form__input-error_active")}(e,t,t.validationMessage)}(e,o),c(t,n)}))}))}(e)})),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-35/cards",{headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){t.forEach((function(t){var a=n(t,o,r,D,z,e);d.append(a)}))})).catch((function(e){console.log(e)})),fetch("https://nomoreparties.co/v1/wff-cohort-35/users/me",{headers:{authorization:"aa96e32a-ada3-4c29-93c6-560570ea205d"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){z=e._id,j.textContent=e.name,x.textContent=e.about,e.avatar&&(document.querySelector(".profile__image").style.backgroundImage="url('".concat(e.avatar,"')"))})).catch((function(e){console.log(e)}))})();